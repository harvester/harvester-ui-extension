(("undefined"!==typeof self?self:this)["webpackChunkharvester_1_0_6"]=("undefined"!==typeof self?self:this)["webpackChunkharvester_1_0_6"]||[]).push([[472],{14472:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ve}});var r=a(9274);const o=e=>((0,r.pushScopeId)("data-v-5745bf0e"),e=e(),(0,r.popScopeId)(),e),s={key:0,class:"upgrade"},n=o((()=>(0,r.createElementVNode)("i",{class:"warning icon-fw icon icon-dot-open dot-icon"},null,-1))),l={class:"upgrade-info mb-10"},c={key:0,class:"repoInfo"},d={class:"row"},i={class:"col span-12"},p=["href"],g={key:0,class:"row mb-5"},u={class:"col span-12"},m={class:"state"},h={key:1,class:"row mb-5"},v={class:"col span-12"},f={class:"state"},y={class:"error ml-5"},N=o((()=>(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1))),V={class:"row mb-5"},E={class:"col span-6"},b={class:"text-muted"},w={class:"col span-6"},k={class:"text-muted"},S={class:"row mb-5"},R={class:"col span-6"},D={class:"text-muted"},x={class:"col span-6"},P={class:"text-muted"},I={class:"row mb-5"},B={class:"col span-6"},C={class:"text-muted"},L={class:"col span-6"},M={class:"text-muted"},A=o((()=>(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1))),U={key:1,class:"text-error mb-20"},_={key:2},G={class:"float-r text-info"},F={class:"text-warning"},T=o((()=>(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1))),$={class:"float-r text-info"},O={key:3,class:"text-warning"},z=o((()=>(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1))),H=o((()=>(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1))),W={class:"footer"},j=["disabled"];function K(e,t,a,o,K,Y){const q=(0,r.resolveComponent)("BadgeStateFormatter"),J=(0,r.resolveComponent)("PercentageBar"),Q=(0,r.resolveComponent)("ProgressBarList"),X=(0,r.resolveComponent)("v-dropdown"),Z=(0,r.resolveDirective)("clean-tooltip");return Y.enabled&&Y.isShow?((0,r.openBlock)(),(0,r.createElementBlock)("div",s,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createBlock)(X,{"popper-class":"upgrade-header-dropdown",class:"hand"},{popper:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",l,[Y.repoInfo?((0,r.openBlock)(),(0,r.createElementBlock)("div",c,[(0,r.createElementVNode)("div",d,[(0,r.createElementVNode)("div",i,[(0,r.createElementVNode)("a",{href:Y.releaseLink,target:"_blank"},(0,r.toDisplayString)(Y.upgradeVersion),9,p)])]),Y.latestResource?((0,r.openBlock)(),(0,r.createElementBlock)("div",g,[(0,r.createElementVNode)("div",u,[(0,r.createElementVNode)("p",m,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.upgradeStatus"))+": ",1),(0,r.createVNode)(q,{class:"ml-5",row:Y.latestResource},null,8,["row"])])])])):(0,r.createCommentVNode)("",!0),Y.downloadLogFailReason?((0,r.openBlock)(),(0,r.createElementBlock)("div",h,[(0,r.createElementVNode)("div",v,[(0,r.createElementVNode)("p",f,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.logStatus"))+": ",1),(0,r.createElementVNode)("span",y,(0,r.toDisplayString)(Y.downloadLogFailReason),1)])])])):(0,r.createCommentVNode)("",!0),N,(0,r.createElementVNode)("div",V,[(0,r.createElementVNode)("div",E,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.os"))+": ",1),(0,r.createElementVNode)("span",b,(0,r.toDisplayString)(Y.repoInfo.release.os),1)]),(0,r.createElementVNode)("div",w,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.productLabel"))+": ",1),(0,r.createElementVNode)("span",k,(0,r.toDisplayString)(Y.repoInfo.release.harvester),1)])]),(0,r.createElementVNode)("div",S,[(0,r.createElementVNode)("div",R,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.harvesterChart"))+": ",1),(0,r.createElementVNode)("span",D,(0,r.toDisplayString)(Y.repoInfo.release.harvesterChart),1)]),(0,r.createElementVNode)("div",x,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.monitoringChart"))+": ",1),(0,r.createElementVNode)("span",P,(0,r.toDisplayString)(Y.repoInfo.release.monitoringChart),1)])]),(0,r.createElementVNode)("div",I,[(0,r.createElementVNode)("div",B,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.kubernetes"))+": ",1),(0,r.createElementVNode)("span",C,(0,r.toDisplayString)(Y.repoInfo.release.kubernetes),1)]),(0,r.createElementVNode)("div",L,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("product.rancher"))+": ",1),(0,r.createElementVNode)("span",M,(0,r.toDisplayString)(Y.repoInfo.release.rancher),1)])]),A])):(0,r.createCommentVNode)("",!0),Y.overallMessage?((0,r.openBlock)(),(0,r.createElementBlock)("p",U,(0,r.toDisplayString)(Y.overallMessage),1)):(0,r.createCommentVNode)("",!0),Y.showImage?((0,r.openBlock)(),(0,r.createElementBlock)("div",_,[(0,r.createElementVNode)("h4",null,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.upgradeImage")),1),(0,r.createElementVNode)("span",G,(0,r.toDisplayString)(Y.imageProgress)+"%",1)]),(0,r.createVNode)(J,{"model-value":Y.imageProgress,"preferred-direction":"MORE"},null,8,["model-value"]),(0,r.createElementVNode)("p",F,(0,r.toDisplayString)(Y.imageMessage),1),T])):(0,r.createCommentVNode)("",!0),(0,r.createElementVNode)("h4",null,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.createRepository"))+" ",1),(0,r.createElementVNode)("span",$,(0,r.toDisplayString)(Y.repoReady.isReady?e.t("harvester.upgradePage.succeeded"):e.t("harvester.upgradePage.pending")),1)]),Y.repoReady.message?((0,r.openBlock)(),(0,r.createElementBlock)("p",O,(0,r.toDisplayString)(Y.repoReady.message),1)):(0,r.createCommentVNode)("",!0),z,(0,r.createVNode)(Q,{title:e.t("harvester.upgradePage.upgradeNode"),percent:Y.nodesPercent,list:Y.nodesStatus},null,8,["title","percent","list"]),H,(0,r.createVNode)(Q,{title:e.t("harvester.upgradePage.upgradeSysService"),percent:Y.sysServiceTotal,list:Y.sysServiceUpgradeMessage},null,8,["title","percent","list"])]),(0,r.createElementVNode)("div",W,[Y.canStartedDownload?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,disabled:K.logDownloading,class:"btn role-primary mr-10",onClick:t[0]||(t[0]=e=>Y.downloadLog())},[(0,r.createElementVNode)("i",{class:(0,r.normalizeClass)(["icon mr-10",[K.logDownloading?"icon-spinner icon-spin":"icon-download"]])},null,2),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.downloadLog")),1)],8,j)):(0,r.createCommentVNode)("",!0),Y.latestResource.isUpgradeSucceeded?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"btn role-primary",onClick:t[1]||(t[1]=e=>Y.ignoreMessage())},(0,r.toDisplayString)(e.t("harvester.upgradePage.dismissMessage")),1)):(0,r.createCommentVNode)("",!0)])])),default:(0,r.withCtx)((()=>[(0,r.renderSlot)(e.$slots,"button-content",{},(()=>[n]),!0)])),_:3})),[[Z,{placement:"bottom-left"}]])])):(0,r.createCommentVNode)("",!0)}var Y=a(35664),q=a(88339),J=a(2602),Q=a(12243),X=a(74562),Z=a(65359),ee=a(20652),te=a(32766);const ae={class:"bar-list"},re={class:"float-r text-info"},oe={class:"total-bar"},se={class:"bar"},ne={class:"custom-content"},le={class:"warning"};function ce(e,t,a,o,s,n){const l=(0,r.resolveComponent)("PercentageBar"),c=(0,r.resolveComponent)("Collapse");return(0,r.openBlock)(),(0,r.createElementBlock)("div",ae,[(0,r.createElementVNode)("h4",null,[(0,r.createTextVNode)((0,r.toDisplayString)(a.title)+" ",1),(0,r.createElementVNode)("span",re,(0,r.toDisplayString)(a.percent)+"%",1)]),(0,r.createElementVNode)("div",null,[(0,r.createElementVNode)("div",null,[(0,r.createVNode)(c,{open:s.open,"onUpdate:open":t[1]||(t[1]=e=>s.open=e)},{title:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",oe,[(0,r.createElementVNode)("span",se,[(0,r.createVNode)(l,{"model-value":a.percent,"preferred-direction":"MORE"},null,8,["model-value"])]),(0,r.createElementVNode)("span",{class:"on-off",onClick:t[0]||(t[0]=(...e)=>n.handleSwitch&&n.handleSwitch(...e))},(0,r.toDisplayString)(s.open?e.t("harvester.generic.close"):e.t("harvester.generic.open")),1)])])),default:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",ne,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.list,((e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t},[(0,r.createElementVNode)("p",null,[(0,r.createTextVNode)((0,r.toDisplayString)(e.name)+" ",1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["status",{[e.state]:!0}])},(0,r.toDisplayString)(e.state),3)]),(0,r.createVNode)(l,{"model-value":e.percent,"preferred-direction":"MORE"},null,8,["model-value"]),(0,r.createElementVNode)("p",le,(0,r.toDisplayString)(e.message),1)])))),128))])])),_:1},8,["open"])])])])}var de=a(12137),ie={name:"HarvesterUpgradeProgressList",components:{PercentageBar:Q.A,Collapse:de.A},props:{title:{type:String,default:""},percent:{type:Number,default:0},list:{type:Array,default:()=>[]}},data(){return{open:!0}},methods:{handleSwitch(){this.open=!this.open}}},pe=(a(46183),a(47433));const ge=(0,pe.A)(ie,[["render",ce],["__scopeId","data-v-1acd4c96"]]);var ue=ge,me={name:"HarvesterUpgradeHeader",components:{PercentageBar:Q.A,ProgressBarList:ue,BadgeStateFormatter:X.A},async fetch(){const e={};this.$store.getters["harvester/schemaFor"](te.rk.IMAGE)&&(e.images=this.$store.dispatch("harvester/findAll",{type:te.rk.IMAGE})),this.$store.getters["harvester/schemaFor"](te.rk.UPGRADE)&&(e.upgrades=this.$store.dispatch("harvester/findAll",{type:te.rk.UPGRADE})),this.$store.getters["harvester/schemaFor"](Y.NW)&&(e.nodes=this.$store.dispatch("harvester/findAll",{type:Y.NW})),this.$store.getters["harvester/schemaFor"](te.rk.UPGRADE_LOG)&&(e.upgradeLogs=this.$store.dispatch("harvester/findAll",{type:te.rk.UPGRADE_LOG})),await(0,q.kR)(e)},data(){return{filename:"",logDownloading:!1}},computed:{...(0,Z.L8)(["currentProduct","isVirtualCluster"]),enabled(){return this.isVirtualCluster&&this.currentProduct.name===ee.KR},latestResource(){return this.$store.getters["harvester/all"](te.rk.UPGRADE).find((e=>e.isLatestUpgrade))},latestUpgradeLogResource(){const e=`${this.latestResource.id}-upgradelog`;return this.$store.getters["harvester/all"](te.rk.UPGRADE_LOG).find((t=>t.id===e))},downloadLogFailReason(){if(!this.filename){const e=this.latestUpgradeLogResource?.latestArchivesFileName;return this.latestUpgradeLogResource?.downloadArchivesStatus(e)}return this.latestUpgradeLogResource?.downloadArchivesStatus(this.filename)},canStartedDownload(){return this.latestUpgradeLogResource?.canStartedDownload||!1},overallMessage(){return this.latestResource?.overallMessage},upgradeImage(){const e=this.latestResource?.upgradeImage;return this.$store.getters["harvester/all"](te.rk.IMAGE).find((t=>t.id===e))},imageProgress(){return this.upgradeImage?.progress||0},showImage(){return!this.latestResource.isUpgradeSucceeded},imageMessage(){return this.latestResource?.upgradeImageMessage},repoReady(){return this.latestResource.createRepo},isShow(){return this.latestResource&&!this.latestResource.hasReadMessage},nodesStatus(){return this.latestResource?.nodeUpgradeMessage},sysServiceUpgradeMessage(){return this.latestResource?.sysServiceUpgradeMessage},sysServiceTotal(){return this.sysServiceUpgradeMessage?.[0].percent||0},nodesPercent(){return this.latestResource?.nodeTotalPercent||0},repoInfo(){return this.latestResource.repoInfo},releaseLink(){return`https://github.com/harvester/harvester/releases/tag/${this.latestResource?.spec?.version}`},upgradeVersion(){return this.latestResource?.spec?.version}},methods:{ignoreMessage(){this.latestResource.setLabel(J.r.REAY_MESSAGE,"true"),this.latestResource.save()},async generateLogFileName(){const e=await this.latestUpgradeLogResource.doActionGrowl("generate");this.filename=e?.data},waitFileGeneratedReady(){const e=this.latestUpgradeLogResource.id;return new Promise((t=>{let a;const r=setInterval((async()=>{a=await this.$store.dispatch("harvester/find",{type:te.rk.UPGRADE_LOG,id:e,opt:{force:!0}},{root:!0}),a.fileIsReady(this.filename)&&(this.logDownloading=!1,clearInterval(r),t())}),2500)}))},async downloadLog(){this.logDownloading=!0,await this.generateLogFileName(),this.waitFileGeneratedReady().then((()=>{this.downloadLogFailReason||this.latestUpgradeLogResource.downloadLog(this.filename),this.logDownloading=!1}))}}};a(80168),a(54782);const he=(0,pe.A)(me,[["render",K],["__scopeId","data-v-5745bf0e"]]);var ve=he},81128:function(e,t,a){"use strict";a.r(t);var r=a(36758),o=a.n(r),s=a(40935),n=a.n(s),l=n()(o());l.push([e.id,".upgrade-header-dropdown .v-popper__arrow-container{display:none}",""]),t["default"]=l},85054:function(e,t,a){"use strict";a.r(t);var r=a(36758),o=a.n(r),s=a(40935),n=a.n(s),l=n()(o());l.push([e.id,"a[data-v-5745bf0e]{float:right;color:var(--link)!important;text-decoration:none}.upgrade[data-v-5745bf0e]{height:100%;min-width:40px;display:flex;align-items:center}.upgrade .dot-icon[data-v-5745bf0e]{font-size:24px;vertical-align:middle;color:#00a483}.upgrade-info[data-v-5745bf0e]{min-width:550px;max-height:90vh;overflow-y:scroll}.upgrade-info .repoInfo .col span[data-v-5745bf0e]{word-break:break-all}.upgrade-info .repoInfo p.state[data-v-5745bf0e]{display:flex;align-items:center}.upgrade-info .error[data-v-5745bf0e]{color:var(--error)}.upgrade-info .float-r[data-v-5745bf0e]{float:right}.upgrade-info p[data-v-5745bf0e]{word-break:break-word;margin-top:5px}.footer[data-v-5745bf0e]{display:flex;justify-content:flex-end}",""]),t["default"]=l},64935:function(e,t,a){"use strict";a.r(t);var r=a(36758),o=a.n(r),s=a(40935),n=a.n(s),l=n()(o());l.push([e.id,".bar-list .float-r[data-v-1acd4c96]{float:right}.bar-list .total-bar[data-v-1acd4c96]{display:flex;-webkit-user-select:none;-moz-user-select:none;user-select:none}.bar-list .total-bar>.bar[data-v-1acd4c96]{width:85%}.bar-list .total-bar .on-off[data-v-1acd4c96]{margin-left:10px;cursor:pointer}.bar-list .custom-content[data-v-1acd4c96]{margin-bottom:14px}.bar-list .custom-content p[data-v-1acd4c96]{margin-bottom:4px}.bar-list .custom-content .status[data-v-1acd4c96]{float:right}.bar-list .custom-content .Pending[data-v-1acd4c96],.bar-list .custom-content .Succeeded[data-v-1acd4c96],.bar-list .custom-content .Upgrading[data-v-1acd4c96]{color:var(--success)}.bar-list .custom-content .failed[data-v-1acd4c96],.bar-list .custom-content .warning[data-v-1acd4c96]{color:var(--error)}",""]),t["default"]=l},80168:function(e,t,a){var r=a(81128);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("391b5cb5",r,!0,{sourceMap:!1,shadowMode:!1})},54782:function(e,t,a){var r=a(85054);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("68e9c16a",r,!0,{sourceMap:!1,shadowMode:!1})},46183:function(e,t,a){var r=a(64935);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("d190e44a",r,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=harvester-1.0.6.umd.min.472.js.map